# 0. 项目速览

* **工作名**：霓虹战机（Neon Aster）
* **类型**：竖屏 Roguelite 飞行射击（**关卡制**，每关 3–5 分钟），移动端优先，PC 兼容
* **参考美术**：提供截图的“霓虹线框+渐隐辉光+深色太空背景+高对比配色”，大数字飘字、几何敌人、多色编码（白/黄/紫/红）
* **技术路线**：WebGL 2D 渲染（PixiJS 或 Phaser Render 级）+ TypeScript + 轻量 ECS（bitecs / ecsy，或自研）
* **设计目标**：单手可玩、**3–5 分钟/关**（支持连续多关）、强成长与合成、数据驱动可扩展（敌人/技能/道具/关卡均表驱动）

---

# 1. 核心体验与循环（Core Loop）

**核心承诺**：爽快清怪 + 随机 BD（Build）成长 + 持续资源拉扯（走位/磁吸/拾取/升级/大招时机）。

**局内循环**：

1. 移动与自动射击 → 2) 击杀掉落 XP 与道具 → 3) 升级出现 3–4 张升级卡 → 4) 组合武器与被动 → 5) 周期性精英/小 Boss → 6) 生存至倒计时结束或击败 Boss → 7) **关卡结算**（评分/奖励）并记录可带出资源。

**局外循环**：

* 解锁新武器/角色/遗物 → 周期任务 → 难度阶梯（世界末日 I/II/III…）。

**局时**：**单关 3–5 分钟**（普通），5–6 分钟（关底/挑战）；（可选）3–4 关组成一章节，章节通关约 12–15 分钟。

---

# 2. 目标平台与性能预算

* **设备**：iOS/Android（Safari/Chrome），PC（Chrome/Edge）。
* **分辨率**：设计分辨率 1080×1920；最小适配 720×1280；PC 竖屏窗口模式 720×1280 以上。
* **帧率目标**：60 FPS（中低端机 ≥ 45 FPS）。
* **对象规模**：屏显敌人 ≤ 180；投射物 ≤ 250；飘字 ≤ 60；UI DrawCall 合并。
* **性能策略**：对象池、四叉树/网格分区碰撞、圆形/胶囊体优先、批渲染、组件稀疏存储、无 GC 峰值。

---

# 3. 交互与操控

* **移动端**：

  * 默认自动射击；触摸屏幕任意位置，飞机追随手指移动（绝对跟随）。
  * 飞机位于手指上方，避免遮挡视野。
  * 单指操控，精确控制。
  * 右上角：暂停、倍速（×1/×1.5/×2）（待实现）。
* **PC**：WASD/方向键移动，鼠标指向自动瞄准（或纯前射），空格冲刺，Esc 暂停。
* **反馈**：Haptics（移动端轻震）、击杀震屏（细微）、受击音+闪白、拾取磁吸音。

---

# 3.1 启动与主菜单

* **启动流程**：应用初始化 → 显示主菜单（暂停世界）  
* **主菜单设计**：
  * 上部：霓虹风格游戏标题图片（带脉冲动画效果，Y=340）
  * 中部：关卡卡片预览（Y=680，400x180）
    - 显示当前选中关卡的详细信息
    - 包含关卡名称、类型标签、时长、难度、描述
    - 边框颜色根据关卡类型变化（限时=青、无尽=紫、Boss=粉、生存=金）
    - 点击卡片打开关卡选择界面
    - 选择新关卡后卡片自动更新显示
* 下部：三个主要按钮（Y=880起，间距100px）
    - `进入游戏` - 主按钮，高亮显示，开始游戏
    - `天赋升级` - 进入天赋树界面
    - `弧线测试` - 打开 Looping Curve 调试视图，仅渲染当前弧线轨迹（用于截图与节奏校准）
* **视觉特性**：
  * 深色半透明背景（80% 透明度）
  * Logo大幅放大，震撼视觉，占据主要视觉焦点
  * 整体界面下移，平衡感更强
  * 霓虹风格按钮（大尺寸373x80 + 圆角16px）
  * 霓虹渐变配色（与Logo统一）：
    - 偏蓝青色（0x00b8ff）到粉红色（0xff0088）双层边框
    - 双层发光效果，偏蓝青色+粉红叠加
    - 主按钮文字使用渐变色
    - 偏蓝青色文字阴影增强霓虹感
    - 颜色更接近Logo中的蓝色调
  * 按钮字体放大（普通21px，主按钮24px）
  * 鼠标悬停有缩放与发光增强效果
  * 标题图片有轻微的呼吸脉冲动画（±3% 缩放）
  * 简洁大气设计，移除底部操作提示
* **标题资源**：
  * 路径：`/public/images/title.png`
  * 自动缩放以适应屏幕（最大宽度 98%，最大高度 585px）
  * 大幅放大以突出游戏标识（是原设计的近3倍）
  * 备用方案：加载失败时使用文本标题
* **返回逻辑**：在天赋树界面可点击"返回"回到主菜单
* **实现概述**：`MenuScreen`/`TalentScreen`/`CurveTestScreen`（PixiJS UI），`GameEngine` 负责菜单与各子界面的切换，菜单期间通过 `world.pause()` 冻结系统更新

### 3.1.1 弧线测试视图（CurveTestScreen）

* 从主菜单点击 `弧线测试` 进入，显示当前 `looping_curve` 行为的完整路径（实时读取 `enemy_test` 关卡配置）
* 左、右两个起点均可视化：曲线颜色分别为青色（左侧起点）与粉色（右侧起点）
* 圆点标记实际敌人生成位置与轨迹对齐点，便于核对“排成一串”效果
* 用于截图/调参，界面仅渲染轨迹线条，不进入游戏循环

---

# 3.2 天赋面板交互（UI 原型）

* **展示阶段**：当前为 UI 原型，尚未接入实际数值；使用 `TalentScreen` + `TALENT_NODES` 静态数据
* **初始状态**：仅核心回路可见但未激活，周围节点全部隐藏；符合设计稿图 2
* **解锁与扩散逻辑**：
  * 激活核心回路（消耗 1 星级点数）后，周围 5 个初始节点显示为可点击的图标，同时这些节点的下游以问号显示
  * 问号节点不可点击且无 Tips，只有前置节点激活后才会显示真实图标与名称，并可查看详情与激活
  * 每次激活节点后，该节点的下游问号节点会继续扩散，形成逐步解锁的层次结构
* **视觉语言**：
  * 节点颜色对应系别：进攻/防御/成长/功能/机动，核心为青蓝高亮
  * 连接线根据激活状态切换亮度（已激活更亮，可激活为灰蓝）
  * 右上信息卡实时显示当前选中天赋的名称与描述
  * 左上资源面板展示占位的“核心能量/星级点数/回溯次数”
  * 节点形态：细线描边（待激活）/亮色按钮（可升级）/实心高亮（已满级）/暗红描边（资源不足）
  * 资源配色：核心能量=青、星级点数=金、时间棱晶=紫、王冠令牌=青绿；节点与连线会继承对应颜色
* **交互**：
  * 鼠标滚轮缩放、拖拽平移；移动端双指捏合缩放、单指拖动
  * 支持大规模天赋树，超出单屏亦可流畅浏览
  * 点击天赋节点弹出详情，点击空白区域隐藏提示卡片
  * 激活/升级通过详情卡片右下角按钮确认，避免误触
  * 详情内容自动换行，并在需要时动态增高面板
* **数据来源**：`src/data/talents/talentTree.ts`，主要字段包含 `title/description/shortLabel/category/position/connections`

---

# 4. 颜色设计规范

本游戏采用统一的霓虹赛博朋克配色方案，基于Logo的蓝-粉渐变设计。详细规范请参考：[颜色设计文档](docs/COLOR_DESIGN.md)

## 核心色系

| 颜色 | 色值 | 用途 |
|------|------|------|
| 霓虹蓝 | `0x00b8ff` | 玩家飞机、主UI、友方元素 |
| 霓虹粉 | `0xff0088` | 敌方元素、警告、危险 |
| 霓虹紫 | `0xaa44ff` | Boss、精英、特殊道具 |
| 霓虹橙 | `0xff8844` | 爆炸、火焰、严重警告 |
| 霓虹金 | `0xffdd44` | 奖励、经验、收益 |
| 霓虹绿 | `0x00ff88` | 治疗、增益、正面效果 |
| 霓虹青 | `0x00ddff` | 辅助、次要友方 |

## 实体颜色分配

### 玩家系统
- **玩家飞机**：霓虹蓝（0x00b8ff）
- **玩家子弹**：浅蓝（0x88ddff）
- **僚机**：霓虹青（0x00ddff）
- **僚机子弹**：淡青（0x66ccff）

### 敌人系统（按形状）
- **六边形**：霓虹蓝（0x00b8ff）
- **三角形/箭头**：霓虹粉（0xff0088）
- **方形/菱形**：霓虹紫（0xaa44ff）
- **圆形**：霓虹青（0x00ddff）

### Boss系统
- **Boss主体**：霓虹粉（0xff0088）
- **Boss发光**：霓虹紫（0xaa44ff）叠加
- **Boss子弹**：粉紫混合（0xff44aa）

### 拾取物
- **经验碎片**：霓虹金（0xffdd44）
- **治疗包**：霓虹绿（0x00ff88）
- **特殊道具**：霓虹紫（0xaa44ff）

## 使用规则

1. **友敌分明**：蓝色系=友方，粉/紫/橙色系=敌方，金/绿色系=中立收益
2. **形状颜色绑定**：敌人颜色由形状决定，保持一致性
3. **发光必备**：所有霓虹元素必须有发光效果（alpha 0.3-0.8）
4. **严格遵守**：所有颜色使用必须符合规范，详见 [COLOR_DESIGN.md](docs/COLOR_DESIGN.md)

---

# 5. 视觉与音频风格（Art Bible 摘要）

* **画面**：深色星空噪点背景 + 霓虹描边几何体（线宽 2–4px），加法混合发光（外发光/模糊 RT）。
* **配色**：遵循上述颜色设计规范，采用霓虹蓝-粉-紫渐变色系
* **UI**：

  * 顶部：关卡名（如"世界末日 I"）、进度条、计时、等级。
  * 底部：半圆护盾/攻击扇区、武器冷却环、能量槽（大招）。
* **音频**：合成器电子音、射击分层音效（主武器/副武器/爆炸），升级"叮"提示，Boss 入场低频。

---

# 6. 数值与属性（Stats）

**基础属性**：

* HP/Shield、ATK（伤害）、FireRate（射速）、ProjSpeed（弹速）、BulletSize、Pierce（穿透）、Bounce（弹跳）、CritChance/CritDamage、MoveSpeed、Magnet（吸取半径）、Luck（少量影响掉落/稀有合成）、CDR（冷却缩短）。

**公式示例**：

* 伤害 = 基础伤害 × (1 + ATK%) × 暴击倍率 × 标签克制（几何系/机械系等）。
* 每级曲线：线性主干 + 软上限（减益增长）。
* 叠加规则：同类 **加法**，跨类 **乘法**（易读易调）。

---

# 7. 敌人与关卡

**敌人族系**（线框几何）：

* **六边环**（慢、肉、接触伤害高）
  - 基础型：仅撞击伤害
  - 射手型：装备直射武器
* **箭头群**（快、脆、成群扑杀）
  - 基础型：快速俯冲
  - 狙击型：装备瞄准武器
  - **环形尖兵**：垂直列队下潜，正切进入圆弧后绕向远侧，再沿出生侧水平切线飞离屏幕（`looping_curve` AI，可通过敌人配置的 `aiParams.entry/arc/exit` 调整入场高度、圆弧半径和离场角度，路径会自动保持平滑，并依据实际出生高度延展入场段，避免纵向队列在屏外堆叠）
* **菱形追踪者**（精英、追踪导弹）
  - 装备追踪导弹，持续威胁
  - 距离触发射击
* 旋臂块（分裂/旋转）- 未实现
* 电晶体（发射弹幕/追踪）- 未实现
* **精英**（紫）：更大体型、护甲、专属技能（冲锋/放射）
* **Boss**（红）：多阶段，召唤/范围压制

**敌人武器系统**（已实现 v0.6.0）：
* 敌人可装备武器，向玩家发射子弹
* 4 种武器类型：直射弹、瞄准弹、追踪导弹、散射弹
* 射击条件可配置：屏幕内触发（默认）、距离触发、总是射击
* 首次射击延迟可配置（敌人类型、关卡、波次多层覆盖）
* 子弹颜色：普通弹霓虹橙、特殊弹霓虹粉

**关卡目标类型**（每关随机或预设 1 种）：

* 生存至时限 / 击败关底 Boss / 净化（清理指定数量敌人或巢穴）/ 护送或占点（保持在半径内）。
* 目标带来**评分项**：用时、受伤、连杀、拾取率。

**生成逻辑**：

* **脚本化波次**（wave_script）：精确时间轴控制，适合设计关卡节奏
* **算法生成**（algorithm）：权重随机，难度递增，适合无尽模式
* 支持**倍数系统**：波次级和关卡级倍数调整难度曲线
* 屏外环绕刷怪（避免贴脸生成），6 种编队：直线/纵向单列/V字/圆形/波浪/随机
* `enemy_test` 关卡保留两波 8 敌人的纵向编队：
  * 第一波从左上入场，列队中第 2、6 架为射手
  * 第二波从右上镜像入场，绕行后朝左下离场，同样仅第 2、6 架射击
  * 用于验证 `looping_curve` 行为、镜像路径与部分射击敌人的组合

**地图**：

* 无边界大场（镜头居中玩家），外围“安全线/防线”虚线提示（截图上的蓝色弧线可作为临时护罩技能表现）。

---

# 8. 武器、技能、道具（Roguelite 养成）

**分类**：

* **主动武器**（自动/半自动）：

  * 直射炮（多段进化：穿透→分裂→弹跳）
  * 扇形散射（子弹数+、散布-、近身清理）
  * 轨道卫星（环绕，可发射/回收）
  * 雷射扫射（持续光束，过热机制）
  * 爆裂火箭（AOE，缓速）
* **被动**：攻击/射速/弹速/穿透/暴击/吸附/移速/CDR/护盾回复/拾取收益/幸运。
* **终极**（需能量）：短时无敌+高额火力/全场磁吸/时间减速。
* **道具掉落**：经验碎片、金币、治疗、临时增益（15s）。

**升级卡面板**：每次升级随机 3–4 张（含稀有/史诗概率，受 Luck 轻度影响）。支持 **合成**（同名 5 次升星触发形态进化）。

**羁绊与词条**：

* 例如【电磁系】武器 +【超导】被动 → 触发额外链雷；
* 【几何克制】对特定族系敌人 +20% 伤害。

---

# 9. 数据驱动（表格/JSON 示例）

```json
// weapon.sample.json
{
  "id": "cannon_basic",
  "name": "直射炮",
  "rarity": "common",
  "base": {"damage": 12, "firerate": 3.0, "projSpeed": 900, "pierce": 0},
  "tags": ["kinetic"],
  "levels": [
    {"lvl":1, "mods": {"damage+": 0, "pierce+": 0}},
    {"lvl":2, "mods": {"damage+": 4}},
    {"lvl":3, "mods": {"pierce+": 1}},
    {"lvl":4, "evolve": "cannon_split"}
  ],
  "projectile": {"sprite":"line_bullet", "hitFX":"spark_small"}
}
```

```json
// enemy.sample.json
{
  "id": "hex_ring",
  "hp": 45,
  "speed": 40,
  "damage": 8,
  "radius": 16,
  "ai": "seek_player",
  "loot": {"xp": 2, "dropTable":"t1_common"},
  "tint":"#FFFFFF"
}
```

```json
// wave.timeline.json（片段）
{
  "stages": [
    {"t":0,   "spawn":[{"enemy":"arrow_swarm","count":20}]},
    {"t":30,  "spawn":[{"enemy":"hex_ring","count":12}]},
    {"t":90,  "elite":"purple_core"},
    {"t":540, "boss":"omega_red"}
  ]
}
```

---

# 10. ECS 架构蓝图

**核心理念**：尽量用**数据 + 组件**表达行为，用**系统**迭代状态，用**事件总线**解耦交互。

**常用组件（Components）**：

* Transform(x,y,rotation,scale)
* Velocity(vx,vy), Accel(ax,ay)
* Collider(Circle/Polygon, radius/vertices, layer, mask)
* Health(max,current), Shield, Armor
* Damage(value, critChance, critMul, tags)
* Projectile(ownerId, lifetime, pierce, bounce, homing)
* Weapon(firerate, cooldown, patternId)
* Team(Ally/Enemy/Neutral)
* AI(state, behaviorId, targetId)
* Magnet(range), Pickup(type,value)
* XP(amount), Level(cur, exp, next)
* Loot(tableId), SpawnOnDeath(prefabId,count)
* Status(list<buffId,duration,stacks>)
* Timer(tag, t)
* Render(spriteId, tint, blend, lineWidth)
* Glow(intensity), Shadow, ZOrder
* Input(vx,vy, castUltimate)
* Lifetime(t)
* CameraTarget, UIHook
* Tag: Player, Enemy, Boss, Bullet, XPShard, Hazard

**系统（Systems）**：

* **已实现**：
  - InputSystem、MovementSystem、WeaponSystem（玩家射击）
  - **EnemyWeaponSystem**（敌人射击）、**HomingSystem**（追踪导弹）
  - **VictorySystem**（通关流程/收尾阶段/飞离动画）
    - 通关后通过 `GameEngine` 清理世界系统与事件监听，确保再次进入关卡不会出现节奏加速
  - ProjectileSystem（飞行/命中/穿透/连锁）
  - CollisionSystem（碰撞检测/玩家敌人子弹区分）
  - HealthSystem（血量/死亡事件）
  - AISystem（直线/锯齿/追踪/环形弧线行为）
  - WaveSystem（波次调度/编队生成/通关检测）、BossSystem（多阶段 Boss）
  - PickupSystem（磁吸经验）、UpgradeSystem（升级卡池/收尾阶段跳过）
  - StatModifierSystem（属性修改器）
  - LifetimeSystem（生命周期）、CleanupSystem（屏幕外清理）
  - ParticleSystem（粒子特效）、DeathSystem（死亡爆炸）
  - HitFlashSystem（受击闪烁）
  - RenderSystem（渲染同步）、UISystem（HUD/面板/通关UI）
  - PerformanceSystem（性能监控 / 敌人上限200 / 子弹上限50（玩家+敌人+僚机）/ 清理残留精灵）
* **计划中**：
  - StatusEffectSystem（减速/流血/易伤）
  - AudioSystem（音效系统）
  - CameraSystem（震屏/跟随）
  - SaveSystem（存档系统）

**事件（Events）**：DamageEvent, DeathEvent, SpawnEvent, PickupEvent, LevelUpEvent, CastUltimateEvent, WaveReachedEvent。

**数据流**：输入→系统迭代→事件派发→系统消费→渲染提交。尽量**无侧写**，避免系统间直接引用。

---

# 11. 渲染与特效实现

* **线框与辉光**：矢量绘制到 RenderTexture → 高斯模糊 → Additive 混合叠加主图层（Bloom 伪实现）。
* **描边几何**：预存顶点数组（正多边形/箭头/自定义），运行时按缩放旋转。
* **飘字**：对象池 + 贝塞尔上飘 + 1 秒淡出。
* **护盾弧线/扇区**：用几何扇形 Mesh；CD 可视化为弧形进度。

---

# 12. UI/UX 规格

* 顶部：关卡名、进度条、Lv、计时器；右上角暂停/倍速；**关卡目标与评分条件**常驻可见。
* 中层：精英/Boss 警示条（左右扫入），屏幕边缘红晕受伤提示。
* 底部：半圆攻击扇区、能量槽、虚拟摇杆。
* 升级面板：3–4 卡，左滑刷新（消耗金币/道具）。
* **结算面板**：关卡评分（1–3 星）、统计（击杀/用时/受伤/连杀）、掉落与**可带出资源**（天赋碎片/货币）、下关预览或返回地图。
* 设置：画质（发光/粒子）、灵敏度、震动、语言。

---

# 13. 内容结构与解锁

* **角色**：3 名起步（均不同初始武器/被动）。
* **武器**：6 主武器 + 8 被动（MVP）；进化形态 6 种。
* **关卡**：普通 3 张（10–12 分钟）、挑战 1 张（15 分钟 + Boss）。
* **局外**：

  * 遗物树：通用 + 武器系别分支；
  * 周任务：累计击杀/无伤时间/合成次数。

# 13.1 局外天赋（Meta）与货币

**带出资源（从关卡结算获得）**：

* **天赋碎片（Talent Shards）**：用于点亮/升级天赋；首通/高星有倍率。
* **星币（Credits）**：用于解锁角色/武器/外观，也可用于天赋重置（可选）。

**天赋树结构**：三系并行，逐层解锁，节点 3–5 级：

* **攻势系**：ATK%、射速%、穿透/弹跳上限、暴击率/伤害、小概率“连锁触发”。
* **生存系**：HP/护盾、受伤减免、磁吸、治疗效率、复活次数（稀有）。
* **机动/功能系**：移速、CDR、经验/金币获取率、开局 reroll/ban slot、装备上限 +1（终端）。

**数值边界**：

* 单节点提升 2–5%，同系**加法**、跨系**乘法**；总体 Meta 加成建议 ≤ **25–35%**（避免割裂新手/老玩家难度）。
* 支持**重置/洗点**（花费少量星币或消耗品）。

**关卡评分与产出**：

* 评分条件：用时、受伤、目标完成度、连杀/连击。
* 产出规则：1★=100% 基础，2★=130%，3★=170%；每日首胜 +50%（反刷衰减）。

**局内与局外的边界**：

* **局内成长**：XP→升级卡、临时金币→关内商店/刷新，仅在当关生效。
* **局外成长**：天赋、解锁与外观长期保留。

---

# 14. 存档与随机性

* **局内**：单种子（展示 Seed），可用于复盘；断线重连（LocalStorage/IndexedDB）。
* **局外**：金币/解锁云存（可选）。

---

# 15. 音效与音乐

* BGM 渐进电子；精英/Boss 专属动机；射击层次区分；升级/掉落"正反馈音"。

---

# 16. 分析与调优

* 关键埋点：开局→首次升级→首次精英→死亡/通关→选择卡面分布→FPS 帧时统计。
* 监控：平均局时、留存、武器胜率、卡面出现/选择率、卡面强度（Elo）。

---

# 17. 里程碑（MVP→Alpha→Beta）

**M0（1–2 周）**：项目骨架 + ECS/渲染/输入/对象池/基础敌与子弹/升级 UI（无发光）。
**M1（+2 周）**：关卡框架（计时/目标/评分）+ 波次调度/3 武器/3 被动/精英 + 简易发光与飘字。
**M2（+2 周）**：Boss/终极/合成进化/**结算→带出资源**/**局外天赋树 v1**/性能优化/移动端调优/数据驱动装表。
**M3（+2 周）**：内容扩充/美术统一/音频/埋点/AB 配置/PC 适配/经济与天赋数值回归。

---

# 18. 原型代码骨架（TypeScript 摘要）

```ts
// 伪代码，只展示结构
interface GameConfig { resolution:{w:number,h:number}; }
class World { /* bitecs/自研 ECS，含 eventBus */ }

// Systems 注册
declare const world: World;
world.addSystem(InputSystem)
     .addSystem(MovementSystem)
     .addSystem(WeaponSystem)
     .addSystem(ProjectileSystem)
     .addSystem(CollisionSystem)
     .addSystem(DamageSystem)
     .addSystem(HealthSystem)
     .addSystem(WaveSystem)
     .addSystem(PickupSystem)
     .addSystem(LevelUpSystem)
     .addSystem(StatusEffectSystem)
     .addSystem(RenderSystem);
```

---

# 19. 资产与管线

* **图形**：程序化几何优先，极简贴图；色板 JSON；BMFont/SDF 字体。
* **工具**：Vite 构建、ESBuild/TS、ESLint/Prettier；数据热更（JSON 直读）。

---

# 20. 风险与备选

* 低端机发光代价高 → 降级：降低模糊半径/帧采样/关闭粒子。
* 弹量过高碰撞瓶颈 → 圆形碰撞优先 + 分区网格（cell 64px）。
* 触控遮挡 → 底部 40% 为交互区，敌刷不进入。

---

# 21. 待决策清单（需要随开发确认）

* 引擎：PixiJS + bitecs **或** Phaser 3 + 自研 ECS。
* 自动瞄准方式：最近敌 / 扇区内优先 / 目标锁定。
* 局外经济：是否加入广告激励（纯可选），或仅内测期关闭商业化。

---

# 22. MVP 实现进展

## ✅ 已完成功能（2025-11-06）

### 核心架构
- ✅ Vite + TypeScript 项目框架
- ✅ PixiJS v8 渲染引擎集成
- ✅ 简化 ECS 架构（Entity/Component/System/World）
- ✅ 事件总线系统
- ✅ **数据驱动配置系统**（JSON 驱动游戏内容）

### 美术渲染
- ✅ 霓虹线框渲染系统（ShapeFactory + NeonRenderer）
- ✅ 几何体：六边形、三角形、箭头、圆形
- ✅ 辉光效果（简化版，移动端友好）
- ✅ 星空背景 + 噪点

### 游戏玩法
- ✅ 玩家实体（霓虹蓝箭头飞船，100 HP）
- ✅ 移动控制（WASD/方向键 + 触摸绝对跟随）
- ✅ 自动射击系统（浅蓝子弹）
- ✅ 敌人系统（六边环 + 箭头群）
- ✅ 敌人生成系统（定时刷怪）
- ✅ 圆形碰撞检测
- ✅ 生命值与伤害系统（伤害值可配置）
- ✅ 受击反馈（玩家和敌人都有霓虹闪烁效果）
- ✅ 爆炸特效（敌人死亡，包括撞击玩家时）
- ✅ 经验碎片掉落
- ✅ 磁吸拾取系统
- ✅ 等级系统（经验累积升级）
- ✅ **Roguelite 升级系统**（升级时选择属性强化卡）
  - 分级升级（Lv.1 显示 New，中间 Lv.N，最后 Max）
  - 满级升级不再出现在卡池
  - 11 种升级（火力/射速/弹速/子弹大小/穿透/弹射/生命/移速/磁力/经验/僚机）
  - 调试面板（显示所有可选升级及概率）
- ✅ **僚机支援**（史诗升级，最多 4 架）
  - 霓虹青箭头僚机，垂直向上射击
  - 伤害为主武器 50%，射速与主武器一致
  - 所有僚机同步射击

### UI/UX
- ✅ 顶部 HUD（等级、经验条、计时器、FPS）
- ✅ 血量显示（受伤时在飞机右上角显示 ❤️ 80%，2秒后消失）
- ✅ Game Over 界面（玩家死亡时）
- ✅ **通关结算界面**（关卡完成时）
  - 显示击败敌人数、总经验、生存时间
  - 霓虹风格统计面板
  - 返回主菜单按钮
- ✅ 重新开始按钮
- ✅ **升级选择面板**（3张卡，按稀有度分类，支持分级与概率显示）
- ✅ **升级时暂停**（展示面板期间暂停游戏，选卡后恢复）
- ✅ 移动端触摸支持（绝对跟随模式）
- ✅ 自适应画布缩放（保持长宽比）
- ✅ 测试升级按钮（调试用）

### 性能优化
- ✅ 移动端检测
- ✅ 对象生命周期管理
- ✅ 简化辉光渲染

## 🚧 待扩展功能

### 核心玩法扩展
- ✅ 升级卡选择面板（Roguelite 核心）
- ✅ 分级升级系统（每个升级最多 3-4 级）
- ✅ 僚机支援系统（史诗升级）
- ⏸️ 更多升级卡类型（当前 11 种）
- ⏸️ 更多敌人类型（利用现有配置系统）
- ⏸️ 更多武器变种（利用穿透/弹射/追踪）
- ⏸️ Boss 战设计
- ⏸️ 关卡波次系统

### 美术与反馈
- ✅ 爆炸粒子特效（敌人死亡时）
- ⏸️ 音效系统（射击/击杀/拾取/升级）
- ⏸️ 飘字特效（伤害数字）
- ⏸️ 更多粒子特效（拾取、升级、受击）
- ⏸️ 屏幕震动效果

### 性能优化
- ✅ 对象池系统（已实现，待启用）
- ⏸️ 空间分区碰撞（QuadTree）
- ⏸️ ParticleContainer 批渲染
- ⏸️ WebWorker 计算优化

## 🎮 当前可玩状态

MVP 已实现核心玩法循环：
1. 玩家移动（单手操控）
2. 自动射击敌人
3. 拾取经验升级
4. 霓虹线框美术风格

## 📊 数据驱动架构

### 配置文件系统
所有游戏内容通过 JSON 配置定义，无需修改代码即可调整：

**配置文件位置**: `public/data/`
- `enemies/enemies.json` - 敌人定义（血量、速度、颜色、形状、武器等）
- `weapons/weapons.json` - 武器定义（伤害、射速、子弹属性、发射方向等）
- `players/players.json` - 角色定义（移动速度、初始武器、磁吸范围等）
- `levels/levels.json` - 关卡定义（波次、敌人池、倍数系统等）

**当前关卡** (2个)：
- **线性关卡1**（linear_01）- wave_script 模式
  - 29 个波次，密集节奏（2 秒→1.5 秒），倍数最高 ×2.5
  - **支持通关流程**：最后敌人消失后自动通关
- **测试关卡**（test_level）- algorithm 模式
  - 权重随机生成，难度递增 ×1.03/秒，包含射击敌人
  - 10 分钟固定时长

**通关流程** (wave_script 模式)：
1. 所有波次完成且屏幕无敌人 → 进入收尾阶段
2. 显示"游戏通关"，10 秒倒计时
3. 玩家可继续移动捡经验，升级不暂停游戏
4. 10 秒到或经验豆收集完 → 玩家飞机向上飞离
5. 飞离屏幕后自动返回主菜单

### 数据加载流程
```typescript
// 游戏启动时自动加载所有配置
await gameData.loadAll();

// 运行时查询配置
const enemyConfig = gameData.getEnemy('hex_basic');
const weaponConfig = gameData.getWeapon('cannon_basic');

// 根据配置创建实体
createEnemyFromConfig(world, stage, x, y, enemyConfig);
```

### 扩展性示例

**添加新敌人** - 只需编辑 JSON：
```json
{
  "id": "new_enemy",
  "name": "新敌人",
  "hp": 80,
  "speed": 60,
  "color": 11158783,
  "shape": "diamond"
}
```

**调整难度** - 修改数值：
```json
// 让六边形更难打
{
  "id": "hex_basic",
  "hp": 120,      // 原 60
  "speed": 80     // 原 40
}
```

### 架构优势
- ✅ **零代码添加内容** - JSON 配置即可添加新敌人/武器
- ✅ **快速迭代调优** - 修改配置刷新浏览器即可
- ✅ **类型安全** - TypeScript 接口定义确保配置正确
- ✅ **易于平衡** - 所有数值集中管理

### 相关文档
- 🚀 [快速开始](QUICKSTART.md) - 运行和测试游戏
- 🎨 [颜色设计规范](docs/COLOR_DESIGN.md) - 完整颜色体系与使用规则
- 📖 [配置手册](docs/DATA_CONFIG.md) - 详细配置说明（敌人、武器、玩家）
- 🎮 [关卡配置手册](docs/LEVEL_CONFIG.md) - 关卡、波次、倍数系统
- 🏗️ [架构文档](docs/ARCHITECTURE.md) - 技术架构设计
- 👨‍💻 [开发指南](docs/DEVELOPER_GUIDE.md) - 开发实践
- 📋 [配置示例](docs/CONFIG_EXAMPLES.md) - 各种配置示例
- 📝 [更新日志](CHANGELOG.md) - 版本变更历史
- 📚 [历史文档](docs/history/) - 开发过程记录

## 📝 下一步开发

### 近期计划（1-2周）
1. ✅ 数据驱动架构完成
2. ✅ AI 行为系统完成
3. ✅ 武器系统增强（穿透/弹射/追踪）
4. ✅ 升级系统（分级升级/满级过滤/调试面板）
5. ✅ 关卡系统（脚本化波次/算法生成/编队）
6. ✅ Boss 系统（多阶段切换）
7. ✅ 僚机系统（最多4架，同步射击）
8. ⏸️ 添加更多敌人类型（利用配置）
9. ⏸️ 添加更多武器（利用配置）
10. ⏸️ 关卡结算界面与评分系统

### 中期计划（1-2月）
1. ✅ Boss 战系统（基础完成）
2. ✅ 关卡波次配置（完成）
3. ⏸️ 局外成长系统（天赋树UI已完成，逻辑待接入）
4. ⏸️ 音效系统
5. ⏸️ 飘字特效（伤害数字）
6. ⏸️ 更多美术内容与动画

### 技术优化
- ⏸️ 启用对象池（提升性能）
- ⏸️ 空间分区碰撞优化（QuadTree）
- ⏸️ 配置热重载（开发效率）
- ⏸️ 配置验证系统
