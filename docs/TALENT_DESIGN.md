# 天赋树设计文档

本文档用于规划和讨论天赋系统的内容设计，包括节点效果、资源分配、拓扑结构等。

---

## 资源体系

### 核心能量（青色 0x43d9ff）
- **获取方式**：游戏内经验在结算时转化（通关/死亡都计入）
- **用途**：激活和升级大部分普通天赋
- **特点**：日常可刷，数量充足，主流通货币
- **设计目标**：让玩家有持续的成长感，每次游戏都能积累进度

### 时间棱晶（紫色 0xc49bff）
- **获取方式**：特定成就、挑战奖励
- **用途**：激活玩法改变型天赋（新机制、新武器、新系统）
- **特点**：相对稀缺，解锁新体验
- **设计目标**：重要决策点，改变游戏玩法

### 星级点数（金色 0xffd166）
- **获取方式**：通关关卡、完成特定挑战（不可反复刷）
- **用途**：仅用于升级战舰核心
- **特点**：成就型货币，稀缺
- **设计目标**：关卡解锁进度的门槛

### 王冠令牌（青绿 0x4de3a1）
- **获取方式**：待定
- **用途**：待定（终极天赋/特殊机制）
- **特点**：最稀有
- **设计目标**：后续扩展保留

---

## 天赋节点设计

### 【核心系统】

#### 战舰核心（CORE）
- **资源**：星级点数（金色）
- **消耗**：每级 1 点
- **最大等级**：10
- **效果**：
  - Lv1-3：解锁世界 1-3 关卡
  - Lv4-6：解锁世界 4-6 关卡 + 挑战模式
  - Lv7-9：解锁困难难度 + Boss Rush
  - Lv10：解锁无尽模式 + 最终挑战
- **位置**：中心
- **连接**：4个系别母节点

---

### 【普通天赋 - 核心能量（青色）】

采用**母节点+子节点**树形结构：
- 母节点：系别的核心基础属性，多级升级
- 子节点：该系的专精分支，从母节点延伸

---

#### 一、进攻系（Attack）

- **系别定位**：提供最基础的面板白字伤害与火力分支，母节点负责通用提升，子节点拆成“暴击爆发 / 连续火力 / 穿透AOE”三条线。

##### 母节点：基础伤害提升（ATK）
- **资源**：核心能量（青色）
- **消耗**：依次为 50 / 100 / 150 / 250 / 400 / 600 / 900 / 1300 / 1800 / 2500
- **最大等级**：10
- **效果**：每级 +5% 基础伤害；满级 +50%
- **拓扑**：直接连接四条子分支（CRIT / PIERCE / SPEED / SIZE）

##### 子节点 | 效果一览

| 节点 | shortLabel | 等级上限 | 消耗（核心能量） | 说明 |
| --- | --- | --- | --- | --- |
| 暴击系统 | `CRIT` | 5 | 100 / 250 / 500 / 800 / 1200 | 暴击率依次 +5/+8/+12/+15%，最终获得 30% 概率的连锁暴击 |
| 穿透强化 | `PIERCE` | 3 | 150 / 350 / 700 | 穿透 +1/+2/+3，最后一级移除穿透伤害衰减 |
| 巨弹化 | `SIZE` | 3 | 120 / 280 / 600 | 子弹尺寸 +35/+60/+100%，最终命中时附带范围溅射 |
| 射速增幅 | `SPEED` | 3 | 80 / 180 / 400 | 射速 +12/+18/+30%，配合后续弹速节点 |
| 弹速优化 | `VEL` | 2 | 90 / 220 | 弹速 +30/+50%，需先激活射速增幅 |

> **连线关系**：`ATK → CRIT / PIERCE / SPEED`，`PIERCE → SIZE`，`SPEED → VEL`

---

#### 二、防御/生存系（Defense）

- **系别定位**：最大生命→护盾→减伤→续航，提供持续生存能力。

##### 母节点：基础生命提升（HP）
- **资源**：核心能量
- **消耗**：50 / 100 / 150 / 250 / 400 / 600 / 900 / 1300 / 1800 / 2500
- **最大等级**：10
- **效果**：每级 +10 最大生命，满级 +100；系别内所有子节点均需要至少 Lv1

##### 子节点 | 效果一览

| 节点 | shortLabel | 等级上限 | 消耗（核心能量） | 说明 |
| --- | --- | --- | --- | --- |
| 护盾系统 | `SHLD` | 4 | 100 / 250 / 500 / 900 | 护盾上限逐级 +30/+30/+40，最终破盾时释放冲击波 |
| 伤害减免 | `ARMOR` | 3 | 120 / 300 / 650 | 受伤 -8/-15/-25%，低血时额外 -15% |
| 生命恢复 | `REGEN` | 2 | 150 / 350 | 基础回复 3 HP/5s → 6 HP/3s（未受伤翻倍） |

---

#### 三、成长/资源系（Growth）

- **系别定位**：放大全局经济（经验、掉落、选牌质量），决定单位时间内能拉开多大差距。

##### 母节点：基础经验加成（XP）
- **资源**：核心能量
- **消耗**：40 / 80 / 120 / 200 / 320 / 500 / 750 / 1100 / 1600 / 2300
- **最大等级**：10
- **效果**：每级经验获取 +8%，满级 +80%

##### 子节点 | 效果一览

| 节点 | shortLabel | 等级上限 | 消耗 | 说明 |
| --- | --- | --- | --- | --- |
| 磁吸范围 | `MAG-R` | 4 | 核心能量：80 / 180 / 400 / 800 | 范围 +35/+60/+100/+150% |
| 磁吸速度 | `MAG-S` | 3 | 核心能量：70 / 160 / 380 | 磁吸速度 +50/+100%，最终经验瞬移到身边（需磁吸范围 Lv1） |
| 拾取奖励 | `LOOT` | 3 | 核心能量：90 / 200 / 450 | 经验价值 +12/+25/+40%，并逐步提高稀有掉落率 |
| 升级效率 | `CHOICE` | 2 | 核心能量：200 / 450 | 局内升级面板额外 +1 / +2 选项 |
| 稀有技能保底 | `PITY` | 3 | Lv1：时间棱晶 ×1；Lv2：核心能量 300；Lv3：核心能量 600 | 5/10/15 级保底紫卡：首次解锁（Lv1）让第5级一定出现紫卡；Lv2 追加第10级保底；Lv3 追加第15级保底 |

> **PITY 机制说明**：该节点采用“首次用紫，后续用核心”的混合消耗。面板会在 Tips 中提示当前等级需要的资源以及下一次哪一个等级档位享受保底。
---

#### 四、机动系（Mobility）

- **系别定位**：解决高密度弹幕下的生存空间，强调位移品质和闪避容错。

##### 母节点：基础移速提升（MOVE）
- **资源**：核心能量
- **消耗**：40 / 80 / 120 / 200 / 320 / 500 / 750 / 1100 / 1600 / 2300
- **最大等级**：10
- **效果**：每级 +4% 移速，满级 +40%

##### 子节点 | 效果一览

| 节点 | shortLabel | 等级上限 | 消耗（核心能量） | 说明 |
| --- | --- | --- | --- | --- |
| 闪避训练 | `EVADE` | 3 | 180 / 400 / 800 | 受击触发 0.5s → 0.8s → 1.2s 无敌，并逐步缩短冷却，最终清屏周围弹幕 |
| 灵活机动 | `AGILE` | 2 | 100 / 250 | 移动时碰撞体积 -10/-20%，并提升加速启动响应 |

---

### 3.3 面板落地情况（2025-11-14）

- `TalentScreen` 已按照上述 4 大系别的结构排布节点，布局如下：
  - 战舰核心位于画布中央（360, 540），四个母节点呈菱形分布。
  - 子节点沿着对应象限延展，`connections` 映射真实依赖关系（如 `ATK → PIERCE → SIZE`）。
  - 未解锁的下游节点仍旧显示为问号，直至父节点激活。
- 数据源 `src/data/talents/talentTree.ts` 与本设计文档保持一一对应，含：
  - 母节点与子节点完整列表
  - 坐标系（position）用于在 UI 中绘制
  - `costs` 数组支持单节点多段资源（例如 PITY 首次用时间棱晶，后续改用核心能量）
- `TalentTooltip` 动态展示“下一次升级所需的资源类型与数量”，因此玩家能直接看到“第几级保底”以及所需材料。

> **UI 目前只绘制核心+4系分支**。时间棱晶和王冠令牌系的特殊/终极天赋仍在设计阶段，暂未放入 `TalentScreen`，但下文继续保留其策划稿，方便后续扩展。

---

### 【特殊玩法天赋 - 时间棱晶（紫色）】

#### 武器/攻击类

##### 18. 导弹系统
- **短标签**：MSLE
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁导弹武器升级选项，追踪敌人，AOE爆炸
- **说明**：激活后，局内升级池会出现"导弹"相关升级卡

##### 19. 激光武器
- **短标签**：LASER
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁激光武器升级选项，持续伤害光束
- **说明**：激活后，局内升级池会出现"激光"相关升级卡

##### 20. 散弹系统
- **短标签**：SHOT
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁散弹武器升级选项，扇形近距离高伤
- **说明**：激活后，局内升级池会出现"散弹"相关升级卡

##### 21. 弹射强化
- **短标签**：CHAIN
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁弹射机制，子弹击中后跳向附近敌人
- **说明**：激活后，局内升级池会出现"弹射"相关升级卡

##### 22. 轨道卫星
- **短标签**：ORBIT
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁轨道卫星武器，环绕玩家旋转并发射
- **说明**：激活后，局内升级池会出现"轨道"相关升级卡

#### 防御/辅助类

##### 23. 能量护盾
- **短标签**：ESHLD
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁能量护盾系统，可充能的额外防护层
- **说明**：激活后可在局内升级护盾容量与充能速度

##### 24. 自动拾取
- **短标签**：AUTO
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：全屏自动拾取，经验自动飞向玩家
- **说明**：替代磁吸机制，不再需要靠近

##### 25. 时间减速
- **短标签**：SLOW
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁主动技能"时间减速"，短时间减慢游戏速度
- **说明**：按键触发，CD 60秒，持续3秒

##### 26. 僚机支援
- **短标签**：DRONE
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁僚机系统，1-2架小型僚机跟随射击
- **说明**：局内可升级僚机数量、伤害、射速

##### 27. 伤害光环
- **短标签**：AURA
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：解锁伤害光环，范围内敌人持续受到伤害
- **说明**：局内可升级光环范围与DPS

##### 28. 反伤护甲
- **短标签**：THORN
- **消耗**：1 时间棱晶
- **最大等级**：1
- **效果**：受击时对攻击者造成反伤（受伤值的30%）
- **说明**：局内可升级反伤比例与触发概率

---

### 【终极天赋 - 王冠令牌（青绿）】（待设计）

##### 29. 复活机制
- **短标签**：REVIVE
- **消耗**：待定
- **效果**：死亡后原地复活一次

##### 30. 炸弹系统
- **短标签**：BOMB
- **消耗**：待定
- **效果**：解锁炸弹主动技能，清空屏幕敌人

##### 31. 时间停止
- **短标签**：STOP
- **消耗**：待定
- **效果**：暂停所有敌人5秒，玩家可自由行动

---

## 天赋树拓扑结构（2025-11-14）

### 十字辐射布局（当前 UI 已实现）

```
             [暴击]   [射速]   [弹速]
                \      |      /
                 \   [ATK]   /
                  \    |    /
       [SIZE] ← [PIERCE]   [CORE]   [HP] → [SHLD] → [ARMOR]
                               \            \
                                \            → [REGEN]
                                 \
       [MAG-R] → [MAG-S]   [XP]   [CHOICE] → [PITY]
                  \          \            /
                   \          \        [MOVE] → [EVADE]
                    \          \             \
                     \          → [LOOT]      → [AGILE]
```

- 中心为 `战舰核心（CORE）`
- 四个象限依次对应：上=进攻、右=防御、下=成长、左=机动（UI 中略有偏移以适配 720×1280 画布）
- 每个母节点（ATK/HP/XP/MOVE）连向其子节点；需要前置等级的子节点继续串联（如 `PIERCE → SIZE`、`SPEED → VEL`、`XP → CHOICE → PITY`）
- 目前 UI 未绘制“特殊玩法（时间棱晶）”和“终极（王冠令牌）”分支，它们保留在文档方案中，待下阶段接入

### 依赖规则备忘

- 所有子节点至少需要母节点 Lv1，少数节点额外要求母节点更高等级（如 PITY 要求 XP Lv5）。
- 问号显示策略：当某个节点没有任何已激活的上游连接时，在面板里显示灰色问号，不展示 Tips。
- `TalentScreen` 按 `connections` 数组渲染连线，因此新增节点时务必在父节点和子节点两端都写入对方 ID，确保双向可见。

---

## 待讨论问题

### 1. 节点总数
- 当前规划：约17个普通天赋 + 10个特殊天赋 + 3个终极天赋 = **30个节点**
- 是否需要调整？

### 2. 分支深度
- 当前：每个系别 3-5 层
- 是否需要更深或更浅？

### 3. 特殊天赋位置
- **方案A**：分散在各系终端（需要解锁前置普通天赋）
  - 例如：进攻系终端放"导弹解锁"
- **方案B**：独立成第6分支，从核心直连
- **方案C**：混合模式
- 你倾向哪种？

### 4. 资源消耗平衡
- 核心能量：50-700 不等
- 时间棱晶：每个特殊天赋 1 个
- 星级点数：战舰核心专用
- 是否合理？

### 5. 效果数值
- 当前百分比加成范围：8%-100%
- 是否需要调整力度？

### 6. 缺失内容
- 当前没有"功能系"（CDR、buff持续时间等）
- 是否需要补充？

---

## 下一步

请基于以上内容给我你的反馈：
- 哪些天赋需要调整/删除/新增？
- 资源分配是否合理？
- 拓扑结构是否符合预期？
- 数值力度是否合适？

我会根据你的反馈直接修改这个文档，直到我们把内容定稿，然后再一次性实现到代码中。

