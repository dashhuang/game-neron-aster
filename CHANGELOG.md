# 更新日志

记录霓虹战机项目的版本变更和重要更新。

---

## [v0.5.0] - 2025-11-09

### 🎉 重大更新：颜色设计规范体系

### 🎨 UI/美术

- **主菜单关卡卡片设计**
  - 移除"选择关卡"按钮，改为显示关卡卡片预览
  - 卡片显示当前选中关卡的完整信息（400x180）
  - 包含关卡名称、类型标签、时长、难度、描述
  - 边框颜色根据关卡类型动态变化（限时=青、无尽=紫、Boss=粉、生存=金）
  - 卡片支持悬停效果（缩放1.03倍，发光增强）
  - 点击卡片打开关卡选择界面
  - **动态更新**：选择新关卡后，卡片自动刷新显示新关卡信息
  - 菜单布局优化：关卡卡片在中部，按钮在下部

### 🔧 修复

- **受击颜色恢复问题**
  - 修复玩家受击后颜色恢复为旧绿色的问题（HealthSystem.ts + DeathSystem.ts）
  - 修复敌人受击后形状错误的问题（粉色三角变六边形）
  - HealthSystem现在从配置读取形状，而非通过颜色推断
  - 确保所有实体受击后正确恢复为新颜色规范

- **默认颜色参数修复**
  - 修复NeonRenderer中敌人创建方法的默认颜色（ENEMY_BASIC → ENEMY_HEXAGON/TRIANGLE）
  - 修复UpgradeSystem中僚机默认颜色（0xffd44d → COLORS.COMPANION）
  - 修复UISystem中Game Over文字颜色（ENEMY_BOSS → DAMAGE_TEXT）
  - 更新所有过时的注释（玩家"绿色"→"霓虹蓝"等）

- **文档描述更新**
  - 更新所有文档中"绿色箭头飞船"→"霓虹蓝箭头飞船"
  - 更新"金色僚机"→"霓虹青僚机"
  - 更新"白色子弹"→"浅蓝子弹"
  - 更新DATA_CONFIG.md中的颜色参考表
  - 清理所有过时的颜色描述

### 🎉 重大更新：颜色设计规范体系

#### 颜色规范文档
- **新建文档**：`docs/COLOR_DESIGN.md`
  - 完整的霓虹赛博朋克颜色体系
  - 7种核心色调定义（霓虹蓝/粉/紫/橙/金/绿/青）
  - 实体颜色分配规则（玩家/敌人/Boss/拾取物）
  - UI颜色使用规范
  - 特效颜色标准
  - 颜色组合建议与禁止事项
  - 代码实现参考与色值转换表

#### 颜色系统重构
- **玩家系统**：
  - 玩家飞机：绿色 → 霓虹蓝（0x00b8ff）
  - 玩家子弹：白色 → 浅蓝（0x88ddff）
  - 僚机：新增霓虹青（0x00ddff）
  - 僚机子弹：新增淡青（0x66ccff）

- **敌人系统**（按形状分类）：
  - 六边形：霓虹蓝（0x00b8ff）
  - 三角形/箭头：霓虹粉（0xff0088）
  - 方形/菱形：霓虹紫（0xaa44ff）
  - 圆形：霓虹青（0x00ddff）

- **Boss系统**：
  - Boss主体：红色 → 霓虹粉（0xff0088）
  - Boss发光：新增霓虹紫（0xaa44ff）叠加
  - Boss子弹：新增粉紫混合（0xff44aa）

- **拾取物**：
  - 经验碎片：保持霓虹金（0xffdd44）
  - 治疗包：保持霓虹绿（0x00ff88）
  - 特殊道具：新增霓虹紫（0xaa44ff）

- **UI系统**：
  - 主UI：青色 → 霓虹蓝（0x00b8ff）
  - 进度条：绿色 → 霓虹蓝（0x00b8ff）
  - 警告：保持霓虹橙（0xff8844）
  - 伤害数字：红色 → 霓虹粉（0xff0088）
  - 治疗数字：保持霓虹绿（0x00ff88）

#### 配置文件更新
- `src/config/constants.ts` - 完全重构COLORS对象，新增所有颜色常量
- `public/data/players/players.json` - 玩家颜色更新为霓虹蓝（47359）
- `public/data/enemies/enemies.json` - 敌人颜色按形状更新
- `public/data/bosses/bosses.json` - Boss颜色更新为霓虹粉（16711816）

#### UI组件更新
- `src/ui/UpgradePanel.ts` - 升级卡稀有度颜色使用新规范
- `src/ui/LevelSelectScreen.ts` - 关卡类型颜色使用新规范
- `src/ui/TalentScreen.ts` - 天赋界面使用霓虹蓝
- `src/systems/UISystem.ts` - 血量显示、经验条使用新颜色

### 📖 文档

- `docs/COLOR_DESIGN.md` - 新增完整颜色设计规范文档
- `README.md` - 新增"颜色设计规范"章节（第4章），调整后续章节编号
- `README.md` - 相关文档列表新增颜色规范链接

---

## [v0.4.1] - 2025-11-09

### 🎨 UI/美术

- **主菜单界面重构**
  - 使用霓虹风格标题图片替代文本标题
  - 标题图片添加呼吸脉冲动画（±3% 缩放）
  - 标题Logo大幅放大（最大宽度 98%，最大高度 585px，是原设计的近3倍）
  - Logo位置 Y=340，整体界面下移，视觉更震撼
  - 加载失败时自动降级为文本标题
  - 图片资源路径：`/public/images/title.png`

### ♻️ 优化

- **菜单布局优化**
  - Logo上方留白适中，整体界面下移优化平衡感
  - 按钮位置在中部偏下（Y=720），与大Logo配合更协调
  - 按钮间距增加至 100px，呼吸感更强
  - 移除底部操作提示文字，界面更简洁
  - 菜单元素整体布局更加协调大气
- **菜单按钮视觉升级**
  - 按钮尺寸大幅增加（373x80，增大约33%）
  - 字体大小增大（普通按钮 21px，主按钮 24px）
  - 圆角增大至 16 像素，更加圆润
  - "进入游戏"按钮作为主按钮高亮显示
  - **霓虹渐变配色**（与Logo风格统一）：
    - 双层边框：偏蓝青色（0x00b8ff）+ 粉红色（0xff0088）
    - 双层发光：偏蓝青色和粉红色叠加，营造霓虹效果
    - 主按钮文字使用偏蓝青色到粉红的水平渐变
    - 文字添加偏蓝青色阴影增强霓虹感
    - 颜色调整为更偏蓝，更接近Logo中的蓝色
  - 悬停时边框和发光同步增强
  - 背景透明度优化（深色半透明）

### 📖 文档

- `README.md` - 更新"3.1 启动与主菜单"章节，详细说明新的菜单设计
- `/public/images/README.md` - 新增资源说明文档

---

## [v0.3.5] - 2025-11-08

### ✨ 新增

- **天赋解锁机制重构**
  - 核心回路初始未激活，消耗 1 星级点数后激活
  - 激活后周围 5 个节点显示真实图标与名称，可点击查看 Tips
  - 问号节点（前置未激活）不可点击、无 Tips、仅作预览
  - 每次激活节点后，下游问号节点逐步扩散，形成层次解锁

### ♻️ 优化

- **UI 模块化**
  - 新增 `src/ui/talent/TalentTooltip.ts` 封装提示卡逻辑
  - 提示卡自动定位，支持屏幕边界约束与上/下翻转
  - 提示卡字体放大 50%，内容自动换行与动态高度
  - 移除状态文字展示，简化信息层级
- **日志管理**
  - `GameEngine` 新增调试开关，生产环境静默日志输出

### 📖 文档

- `DATA_CONFIG.md` 新增天赋配置字段说明与示例
- `ARCHITECTURE.md` 补充主菜单/天赋流程与暂停机制
- `README.md` 更新天赋解锁与扩散逻辑说明

---

## [v0.4.0] - 2025-11-08

### 🎉 重大更新：关卡系统

#### 核心功能
- **关卡配置系统**
  - 支持 3 种关卡类型：固定时长/无尽模式/Boss战
  - 配置文件：`levels.json`（3个初始关卡）
  - 完整类型定义（LevelConfig/WaveConfig/BossConfig）
  
- **WaveSystem**（波次管理）
  - 脚本化波次：精确时间轴控制敌人生成
  - 算法生成：按权重随机，难度递增
  - 支持混合模式
  
- **编队系统**
  - 5种编队：随机/直线/V字/圆形/波浪
  - FormationFactory 工厂模式
  - 可自定义参数（间距/半径/角度）
  
- **Boss 系统**
  - 多阶段配置（HP阈值触发）
  - BossSystem 自动切换阶段
  - AI模式/移速/技能可配置
  - Boss 配置文件：`bosses.json`
  
- **关卡选择UI**
  - LevelSelectScreen：显示所有可选关卡
  - 关卡卡片（名称/类型/时长/难度/描述）
  - 根据类型的彩色边框

#### 替换与优化
- WaveSystem 替代旧的 EnemySpawnSystem
- BossSystem 新增
- LevelManager 单例管理关卡状态

### ✨ 新增（其他）

- **DPS与经验收益显示**
  - 右上角实时显示 DPS（最近1秒）
  - 显示 XP/10s（最近10秒经验收益）
  - 用于评估火力与效率

- **测试升级优化**
  - 点击测试升级按钮时玩家等级+1
  - 显示Lv实时更新

### 🔧 修复
- 修复编译错误（BossPhase重复/未使用导入）
- 优化高频日志（移除战斗日志，提升性能）

---

## [v0.3.4] - 2025-11-08

### ✨ 新增（升级与僚机）

- **分级升级系统**
  - 每个升级支持多级（通常 3-4 级），每级效果可独立配置
  - 显示规则：首级 "名称 New"，中间 "名称 Lv.N"，满级 "名称 Max"
  - 满级升级自动从卡池移除
  - 配置文件升级至 v1.1.0（`upgrades.json` 使用 `levels` 结构）
  - 新增 `UpgradeProgress` 组件记录玩家各升级等级

- **弹射子弹**（原弹跳子弹重构）
  - 子弹命中敌人后自动寻找最近的另一敌人并改变弹道
  - 与穿透共存时随机选择弹射或穿透（弹射无目标时回退穿透）
  - 升级配置改为 `chain` 属性

- **僚机支援**（史诗升级）
  - 霓虹青小箭头僚机，最多 4 架，160° 扇形对称分布
  - 固定槽位，按 [左内, 右内, 左外, 右外] 对称补齐
  - 僚机垂直向上射击，伤害为主武器 50%，射速与主武器一致
  - 所有僚机共享冷却，同步齐射
  - 僚机参数可通过 `extra` 配置（fireRate/damageRatio/bulletSpeed/bulletSize）

- **调试升级面板**
  - 点击"测试升级"按钮显示所有未满级升级及其真实概率
  - 支持取消按钮（调试模式专属）

- **moveSpeed/magnetRange/xpGain 接线生效**
  - 新增 `PlayerStats` 组件汇总最终属性
  - `InputSystem`、`PickupSystem` 读取并应用这些倍率

### 🔧 修复

- 修复穿透子弹逻辑（`hitSet` 防止重复命中同一敌人）
- 修复僚机跟随与射击依赖问题
- 清理未使用的导入与变量

### 📖 文档

- `UPGRADE_SYSTEM.md`：新增分级配置示例、满级过滤、弹射/穿透协同、僚机说明
- `DATA_CONFIG.md`：新增 `upgrades.json` 分级结构与兼容说明
- `ARCHITECTURE.md`：补充 `Projectile.hitSet` 与穿透流程
- `README.md`：同步所有新功能

---

## [v0.3.3] - 2025-11-08

### ✨ 新增

- **主菜单与导航**
  - 启动先显示主菜单，顶部“关卡选择”（当前：测试关卡）
  - “进入游戏”按钮：隐藏菜单并进入测试关卡（初始化/恢复世界）
  - “天赋升级”按钮：进入天赋树占位界面，可返回主菜单
  - 菜单/天赋界面使用 PixiJS UI（霓虹风格按钮）
- **引擎流转**
  - `GameEngine` 新增菜单/天赋显示与切换逻辑
  - 菜单/天赋时通过 `world.pause()` 冻结系统更新

### 📖 文档

- `README.md` 新增“3.1 启动与主菜单”

---

## [v0.3.2] - 2025-11-08

### ✨ 新增

- **升级时暂停游戏**：
  - 进入升级界面时调用 `world.pause()`，仅 `RenderSystem/UISystem/UpgradeSystem` 继续更新
  - 选择升级后 `world.resume()` 恢复游戏
  - 新增 `System.updateWhenPaused` 控制系统在暂停时是否继续运行

### 📖 文档

- `ARCHITECTURE.md` 补充暂停机制说明与系统豁免策略
 - `UPGRADE_SYSTEM.md`/`DATA_CONFIG.md`：新增“分级升级（Levels）”配置与选择逻辑说明
 - `upgrades.json` 升级为 v1.1.0（分级结构，满级过滤）

---
## [v0.3.3] - 2025-11-08

### ✨ 新增（接线生效）

- `moveSpeed`：新增 `PlayerStats.moveSpeedMultiplier`，`InputSystem` 按倍率应用移动速度
- `magnetRange`：新增 `PlayerStats.magnetRange`，`PickupSystem` 取玩家与碎片范围较大值作为磁吸范围
- `xpGain`：新增 `PlayerStats.xpGainMultiplier`，`PickupSystem` 拾取经验时按倍率累计

### 🧱 技术

- 新增组件：`PlayerStats`（汇总最终玩家属性，供多系统读取）
- `StatModifierSystem` 计算并写入 `PlayerStats`（兼顾 `maxHP` 已有逻辑）

### 📖 文档

- `UPGRADE_SYSTEM.md`：新增“已接线（生效）属性”小节

---

## [v0.3.1] - 2025-11-07

### 🔧 修复

- **穿透不生效**：
  - 子弹命中后即使未销毁也会 break，无法继续检测其它敌人。
  - 增加 `Projectile.hitSet`，记录已命中的敌人，避免在下一帧仍重叠时重复结算（看起来像“没穿透”）。
  - 现在 `pierce = 1` 可命中 2 名不同敌人，`pierce = 2` 命中 3 名，以此类推。

### 📖 文档

- 同步更新 CHANGELOG，说明修复细节。

---

## [v0.3.0] - 2025-11-06

### 🎉 重大更新：Roguelite 升级系统

#### 核心功能
- **StatModifier 组件** - 属性修改器系统
  - 支持加法和乘法修改器
  - 可叠加多个升级效果
  - 实时计算最终属性值
- **升级配置系统** - upgrades.json
  - 10 种初始升级卡
  - 三种稀有度：普通/稀有/史诗
  - 完整的效果配置
- **升级选择 UI** - 霓虹风格升级面板
  - 升级时显示 3 张随机卡片
  - 根据稀有度显示不同颜色边框
  - 悬停效果和点击交互
  - 选择后立即应用效果
- **UpgradeSystem** - 升级管理系统
  - 按稀有度加权随机（普通70%，稀有25%，史诗5%）
  - 避免重复选项
  - 升级效果持久化
- **StatModifierSystem** - 属性应用系统
  - 实时应用修改器到武器和玩家
  - 支持伤害、射速、血量等属性

#### 可升级属性（10种）
1. **伤害提升** - 伤害 +10%
2. **疾速射击** - 射速 +15%
3. **穿透子弹** - 穿透 +1
4. **弹跳子弹** - 弹跳 +1
5. **生命强化** - 最大HP +20
6. **移速提升** - 移动速度 +10%
7. **磁力增强** - 磁吸范围 +30%
8. **经验加成** - 经验获取 +20%
9. **巨大化** - 子弹大小 +30%
10. **极速弹道** - 弹速 +20%

#### 升级流程
```
击杀敌人 → 获得经验 → 升级
  ↓
暂停游戏
  ↓
显示升级面板（3张卡）
  ↓
选择升级
  ↓
属性立即生效
  ↓
继续游戏
```

---

## [v0.2.2] - 2025-11-06

### ✨ 新增

- **爆炸粒子系统** - 敌人死亡时的霓虹粒子特效
  - 三种爆炸预设：小型、普通、大型
  - 每种敌人可独立配置爆炸效果
  - 粒子继承敌人颜色
  - 支持圆点和线段两种粒子类型
  - 敌人撞击玩家死亡时也会播放爆炸特效
- **玩家受击动效** - 玩家被撞时箭头部分边闪白
  - 与敌人相同的霓虹闪烁效果
  - 5条边随机闪白
  - 持续 0.08 秒
- **血量显示 UI** - 受伤时显示在飞机右上角
  - 格式：❤ 80%（Press Start 2P 像素字体）
  - 位置：玩家飞机右上角跟随
  - 触发：受到伤害时显示
  - 持续：2秒后自动消失
  - 样式：红色文字 + 粗黑边 + 字母间距
- **玩家死亡爆炸特效** - 玩家死亡时播放爆炸特效
  - 可通过 players.json 配置爆炸类型和粒子数
  - 粒子颜色继承玩家颜色（霓虹蓝）
  - 延迟 0.5 秒后显示 Game Over（让爆炸播放完）
- **Game Over 系统** - 玩家死亡时
  - 延迟显示，先播放爆炸特效
  - 显示 Game Over 界面
  - 显示重新开始按钮
  - 点击按钮重新加载游戏
- **绝对跟随操作模式** - 移动端触摸操作改进
  - 飞机追随手指位置移动
  - 飞机位于手指上方 80px，不遮挡视野
  - 更直观的触摸控制体验
- **EnemyData 组件** - 存储敌人配置ID
- **Particle 组件** - 粒子生命周期管理
- **ParticleSystem** - 粒子更新和淡出

### 🔧 修复

- **粒子尺寸优化** - 缩小粒子至 1.5-3 像素
- **爆炸范围调整** - 速度降低至 150-300，更紧凑
- **碰撞逻辑优化** - 敌人撞玩家通过 DAMAGE 事件触发死亡（确保播放特效）
- **伤害配置化** - 敌人撞击伤害从配置读取（六边形8点，三角形5点）

### 🎨 样式

- **字体预加载** - 游戏启动时预加载 Press Start 2P 字体
  - 避免首次显示时字体闪烁
  - 提升用户体验
- **字体优化**
  - 字体大小：12px（适配屏幕，显示完整）
  - 描边：3px 黑色
  - 字母间距：0.5px

### 📖 文档

- 创建 particleConfig.ts 配置文件
- 在 enemies.json 中添加 deathEffect 配置
- 更新 EnemyConfig 类型定义
- 创建 CONTRIBUTING.md 贡献指南
- 同步所有文档与代码实现

---

## [v0.2.1] - 2025-11-06

### 🔧 修复

- **修复所有硬编码尺寸问题** - 全面应用 SCALE_FACTOR 到所有相关参数
  - 拾取距离、边界限制、清理范围
  - 虚拟摇杆尺寸、触摸灵敏度
- **修复 EnemySpawnSystem 使用废弃方法** - 改为使用配置驱动的创建方法
- **修复移动端长宽比变形** - 添加自适应画布缩放，保持 9:16 比例
- **修复敌人受击变形 Bug** - HitFlash 组件保存形状和尺寸信息

### ✨ 新增

- **全局尺寸放大 30%** - 所有游戏物体（玩家、敌人、子弹）放大，UI 文字不变
- **AI 行为初始化** - AISystem 自动初始化 AI 状态，支持 ZigzagBehavior
- **移动端局域网访问** - 配置 Vite 允许局域网内设备访问

### 🗑️ 删除

- 删除废弃方法 `createEnemy()` 和 `EnemyType` 枚举
- 删除废弃方法 `createPlayerBullet()`
- 清理未使用的导入

### 📖 文档

- 更新 ARCHITECTURE.md 系统执行顺序，添加 AISystem 和 ProjectileSystem
- 整合历史文档到 `docs/history/`
- 创建本更新日志

---

## [v0.2.0] - 2025-11-06

### 🎉 重大更新：数据驱动架构

### ✨ 新增

#### 配置系统
- **DataLoader** - 配置加载和管理系统
- **类型定义** - EnemyConfig, WeaponConfig, PlayerConfig
- **JSON 配置文件** - 敌人、武器、角色配置化

#### AI 行为系统
- **AI 组件** - 可配置的 AI 行为
- **3 种基础行为**:
  - `straight_down` - 直线向下
  - `zigzag` - 蛇形摆动
  - `tracking` - 追踪玩家（3种速度变种）
- **AISystem** - 插件化 AI 行为管理

#### 武器系统增强
- **Projectile 组件** - 子弹属性（穿透、弹跳、追踪）
- **ProjectileSystem** - 子弹行为系统
- **穿透支持** - 子弹可穿透多个敌人
- **弹跳支持** - 子弹碰到边界弹跳
- **追踪导弹** - 子弹可追踪敌人

### 📖 文档

- **ARCHITECTURE.md** (250+ 行) - 架构设计详解
- **DATA_CONFIG.md** (200+ 行) - 配置完整手册
- **DEVELOPER_GUIDE.md** (300+ 行) - 开发实战指南
- **CONFIG_EXAMPLES.md** (400+ 行) - 配置示例集合

### 🔄 重构

- 敌人系统完全配置化
- 武器系统完全配置化
- 玩家系统完全配置化
- 实体工厂使用配置驱动

---

## [v0.1.0] - 2025-11-06

### 🎉 MVP 版本发布

### ✨ 功能

#### 核心架构
- **ECS 架构** - Entity/Component/System/World
- **事件总线** - 系统间解耦通信
- **游戏引擎** - PixiJS + 自研 ECS

#### 美术渲染
- **霓虹线框** - ShapeFactory + NeonRenderer
- **辉光效果** - 简化版，移动端友好
- **几何形状** - 六边形、三角形、箭头、圆形
- **星空背景** - 噪点效果

#### 游戏玩法
- **玩家系统** - 箭头飞船（霓虹线框风格）
- **移动控制** - WASD/方向键 + 虚拟摇杆
- **自动射击** - 霓虹风格子弹
- **敌人系统** - 六边形（慢速）+ 三角形（快速）
- **碰撞检测** - 圆形碰撞
- **经验系统** - 磁吸拾取 + 升级
- **受击反馈** - 部分边闪白效果

#### UI/UX
- **顶部 HUD** - 等级、经验条、计时器、FPS
- **虚拟摇杆** - 移动端触摸控制
- **响应式布局** - 适配各种屏幕

#### 性能优化
- **对象池系统** - 复用对象减少 GC
- **实体限制** - 敌人 ≤30，子弹 ≤50
- **屏幕外清理** - 自动清理超出边界实体
- **简化渲染** - 移动端友好的辉光实现

### 📖 文档
- README.md - 项目概览
- QUICKSTART.md - 快速开始指南

---

## 版本号规范

采用语义化版本：`主版本.次版本.修订号`

- **主版本** (v1.0.0)：重大架构变更或破坏性改动
- **次版本** (v0.2.0)：新功能、系统添加
- **修订号** (v0.2.1)：Bug 修复、小优化

---

## 图例

- 🎉 重大更新
- ✨ 新增功能
- 🔧 Bug 修复
- 🔄 重构
- 📖 文档
- 🗑️ 删除
- ⚡ 性能优化
- 🎨 UI/美术

